# Сравнение производительности асинхронной и блокирующей реализации

## Время обработки запроса

|          | PUT old         | PUT new        | GET old        | GET new         |
|----------|---------        |---------       |---------       |---------        |
| 50.000%  |    11.53ms      |     0.91ms     |    1.75ms      |       0.87ms    |
| 75.000%  |    20.05ms      |     1.18ms     |    2.34ms      |       1.13ms    |
| 90.000%  |    31.92ms      |     1.36ms     |    2.97ms      |       1.30ms    |
| 99.000%  |    76.54ms      |     1.55ms     |    5.36ms      |       1.51ms    |
| 99.900%  |   122.50ms      |     2.11ms     |    8.45ms      |       3.23ms    |
| 99.990%  |   162.69ms      |     8.20ms     |   12.89ms      |       7.02ms    |
| 99.999%  |   188.29ms      |    16.61ms     |   15.48ms      |       8.15ms    |
| 100.000% |   204.16ms      |    16.61ms     |   18.43ms      |       8.65ms    |
| timeout% |   3.38e-3       |       13.53    |    3.38e-3     |       7.30      |

По таблице выше видно, что при переходе к асинхронной реализации, время ответа значительно 
сократилось, но также, значительно возросло число таймаутов. 

## Время обработки запроса при смешанной нагрузке
            
|          | status/old | status while get/old | status/new | status while get/new |
|----------|---------   |---------             |---------   |---------             |
| 50.000%  |   1.39ms   |    6.16ms            |   1.75ms   |     3.33ms           |
| 75.000%  |   1.91ms   |   11.87ms            |   2.33ms   |     5.38ms           |
| 90.000%  |   2.37ms   |   21.18ms            |   3.03ms   |     7.70ms           |
| 99.000%  |   3.32ms   |   55.52ms            |   4.88ms   |    15.19ms           |
| 99.900%  |   5.88ms   |  106.11ms            |   6.59ms   |    25.04ms           |
| 99.990%  |  11.35ms   |  228.86ms            |   9.18ms   |    31.84ms           |
| 99.999%  |  14.80ms   | 255.74ms             |  10.72ms   |    35.58ms           |
| 100.000% |  21.66ms   | 260.99ms             |  11.65ms   |    39.49ms           |
| timeout% |  3.36e-3   |   3.38e-3            |  3.40e-3   |    3.39e-3           |

По таблице выше видно, что при переходе к асинхронной реализации, время ответа на
"лёгкие" запросы, выполненые отдельно и во время "тяжёлых" запросов, отличается
в 2 раза, в то время как  при блокирующей реализации, время ответа отличается приблизительно в 5 раз.

 

# Сравнение производительности при переходе к реализации с шардированием

## Время обработки запроса

|          | PUT new         | PUT old        | GET new        | GET old         |
|----------|---------        |---------       |---------       |---------        |
| 50.000%  |    0.95ms       |     0.91ms     |    0.99ms      |       0.87ms    |
| 75.000%  |    1.21ms       |     1.18ms     |    1.25ms      |       1.13ms    |
| 90.000%  |    1.37ms       |     1.36ms     |    1.41ms      |       1.30ms    |
| 99.000%  |    1.56ms       |     1.55ms     |    2.01ms      |       1.51ms    |
| 99.900%  |    3.72ms       |     2.11ms     |    7.28ms      |       3.23ms    |
| 99.990%  |    9.09ms       |     8.20ms     |   12.41ms      |       7.02ms    |
| 99.999%  |   17.07ms       |    16.61ms     |   14.84ms      |       8.15ms    |
| 100.000% |   17.23ms       |    16.61ms     |   18.80ms      |       8.65ms    |
| timeout% |     6.41        |       13.53    |    6.80        |       7.30      |

По таблице выше видно, что лучше не стало, но и хуже тоже не стало.
Это странно, потому что по результатм профиллирования, время похода в другую ноду
за данными, в 2 раза превышает время чтения данных с локальной ноды.
Также это странно потому, что число запускаемых потоков при переходе к кластерной реализации
стало в 3 раза больше, и теперь уже в 6 раз превышает число физических потоков
на машине, на которой проводилось тестирование. По идее, производительность должна
была снизится.  

